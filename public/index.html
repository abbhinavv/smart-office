<!DOCTYPE html>
<html>
<head>
  <title>Smart Office POC</title>
</head>

<body>

<h2>Smart Office - POC Editor</h2>

<button onclick="loadDoc()">Load</button>
<button onclick="saveDoc()">Save</button>
<button onclick="loadTemplate()">Template</button>
<button onclick="exportPDF()">Export PDF</button>
<button onclick="startDictation()">Start Voice Input</button>
<button onclick="stopDictation()">Stop</button>

<div id="editor" contenteditable="true"
     style="border:1px solid black; padding:10px; height:500px;">
</div>

<script>

const editor = document.getElementById("editor");

function saveDoc() {
  fetch("/save", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ content: editor.innerHTML })
  })
  .then(() => alert("Document Saved"));
}

function loadDoc() {
  fetch("/load")
    .then(res => res.json())
    .then(data => {
      editor.innerHTML = data.content;
    });
}

function loadTemplate() {
  fetch("/template")
    .then(res => res.json())
    .then(data => {
      editor.innerHTML = data.content;
    });
}

function exportPDF() {
  window.print();
}

let recognition;

function setupSpeech() {
  const SpeechRecognition =
    window.SpeechRecognition || window.webkitSpeechRecognition;

  if (!SpeechRecognition) {
    alert("Speech recognition is NOT supported in this browser.");
    return;
  }

  const recognition = new SpeechRecognition();

  recognition.lang = "en-US";
  recognition.continuous = true;
  recognition.interimResults = true;

  let finalTranscript = "";

  recognition.onresult = function(event) {
    let interimTranscript = "";

    for (let i = event.resultIndex; i < event.results.length; i++) {
      if (event.results[i].isFinal) {
        finalTranscript += event.results[i][0].transcript + " ";
      } else {
        interimTranscript += event.results[i][0].transcript;
      }
    }

    // Only show confirmed text in editor
    editor.innerHTML = editor.innerHTML + finalTranscript;

    // Reset after inserting
    finalTranscript = "";
  };

  recognition.onerror = function(event) {
    console.log("Speech error:", event.error);
  };

  recognition.start();
}

function startDictation() {
  if (!recognition) {
    setupSpeech();
  }

  recognition.start();
}

function stopDictation() {
  if (recognition) {
    recognition.stop();
  }
}


loadDoc();

</script>

</body>
</html>
